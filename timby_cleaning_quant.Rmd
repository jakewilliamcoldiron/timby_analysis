---
title: "TIMBY Cleaning and EDA, Full"
author: "Jake William Coldiron"
output: pdf_document
date: 22 July 2024
---

```{r setup, include = FALSE}

library(tidyverse)
library(ggplot2)
library(nlme)
library (lattice)
library(lme4)
library(janitor)
library(snakecase)
library(dplyr)
library(patchwork)
library(readxl)

knitr::opts_chunk$set(
  echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

library(viridis)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

```{r importing redcap study id}
#importing redcap study id

timby_redcap_study_id = read_xlsx("./timby_analysis_data/timby_analysis_data_redcap_study_id.xlsx") |> 
  
  rename(juvenileid = djj_id_6digit) 

print(timby_redcap_study_id)
#view(timby_study_id)

```

```{r}
timby_redcap_survey_responses_sep_test = read_xlsx("./timby_analysis_data/timby_analysis_data_redcap_survey_responses.xlsx") |> 
  
  clean_names() |> 
  
  mutate(survey_stage = to_snake_case(as.character(survey_stage))) |>
  separate(tcs_1_how_often_would_you_make_the_following_statement_i_have_a_hard_time_sitting_still_choose_one, into = c("tcs_1"), extra = "drop") |> 
  mutate(tcs_1 = recode(tcs_1, 
                        "A" = as.numeric(0),
                        "B" = as.numeric(1), 
                        "C" = as.numeric(2),
                        "D" = as.numeric(3),
                        "E" = as.numeric(4)
                        )) 

print(timby_redcap_survey_responses_sep_test)

```


```{r importing redcap survey responses}
#importing redcap survey responses

timby_redcap_survey_responses = read_xlsx("./timby_analysis_data/timby_analysis_data_redcap_survey_responses.xlsx") |> 
  
  clean_names() |> 
  
  mutate(survey_stage = to_snake_case(as.character(survey_stage))) |>
  separate(tcs_1_how_often_would_you_make_the_following_statement_i_have_a_hard_time_sitting_still_choose_one, into = c("tcs_1"), extra = "drop") |> 
  mutate(tcs_1 = recode(tcs_1, 
                        "A" = as.numeric(0),
                        "B" = as.numeric(1), 
                        "C" = as.numeric(2),
                        "D" = as.numeric(3),
                        "E" = as.numeric(4)
                        )) |> 
  
  separate(tcs_2_how_often_would_you_make_the_following_statement_i_start_things_but_have_a_hard_time_finishing_them_choose_one, into = c("tcs_2"), extra = "drop") |> 
  mutate(tcs_2 = recode(tcs_2, 
                        "A" = as.numeric(0),
                        "B" = as.numeric(1), 
                        "C" = as.numeric(2),
                        "D" = as.numeric(3),
                        "E" = as.numeric(4)
                        )) |> 
  
  separate(tcs_3_how_often_would_you_make_the_following_statement_i_do_things_without_thinking_choose_one, into = c("tcs_3"), extra = "drop") |> 
  mutate(tcs_3 = recode(tcs_3, 
                        "A" = as.numeric(0),
                        "B" = as.numeric(1), 
                        "C" = as.numeric(2),
                        "D" = as.numeric(3),
                        "E" = as.numeric(4)
                        )) |> 
  
  separate(tcs_4_how_often_would_you_make_the_following_statement_i_need_to_use_a_lot_of_self_control_to_keep_out_of_trouble_choose_one, into = c("tcs_4"), extra = "drop") |> 
  mutate(tcs_4 = recode(tcs_4, 
                        "A" = as.numeric(0),
                        "B" = as.numeric(1), 
                        "C" = as.numeric(2),
                        "D" = as.numeric(3),
                        "E" = as.numeric(4)
                        )) |>
  
  separate(sdq_1_i_try_to_be_nice_to_other_people_i_care_about_their_feelings_choose_one, into = c("sdq_ps_1"), extra = "drop") |> 
  mutate(sdq_ps_1 = recode(sdq_ps_1, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_2_i_am_restless_i_can_not_stay_still_for_long_choose_one, into = c("sdq_hs_2"), extra = "drop") |> 
  mutate(sdq_hs_2 = recode(sdq_hs_2, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_ 
                        )) |> 
  
  separate(sdq_3_i_get_a_lot_of_headaches_stomach_aches_or_sickness_choose_one, into = c("sdq_ess_3"), extra = "drop") |> 
  mutate(sdq_ess_3 = recode(sdq_ess_3, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_4_i_usually_share_with_others_food_games_pens_etc_choose_one, into = c("sdq_ps_4"), extra = "drop") |> 
  mutate(sdq_ps_4 = recode(sdq_ps_4, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_5_i_get_very_angry_and_often_lose_my_temper_choose_one, into = c("sdq_cds_5"), extra = "drop") |>  
  mutate(sdq_cds_5 = recode(sdq_cds_5, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_6_i_am_usually_on_my_own_i_generally_play_alone_or_keep_to_myself_choose_one, into = c("sdq_pps_6"), extra = "drop") |>  
  mutate(sdq_pps_6 = recode(sdq_pps_6, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_7_i_usually_do_as_i_am_told_choose_one, into = c("sdq_cds_7"), extra = "drop") |> 
  #inverted scoring, see sdq documentation
  mutate(sdq_cds_7 = recode(sdq_cds_7, 
                        "Not" = as.numeric(2),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(0),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_8_i_worry_a_lot_choose_one, into = c("sdq_ess_8"), extra = "drop") |>  
  mutate(sdq_ess_8 = recode(sdq_ess_8, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_9_i_am_helpful_if_someone_is_hurt_upset_or_feeling_ill_choose_one, into = c("sdq_ps_9"), extra = "drop") |>  
  mutate(sdq_ps_9 = recode(sdq_ps_9, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_10_i_am_constantly_fidgeting_or_squirming_choose_one, into = c("sdq_hs_10"), extra = "drop") |> 
  mutate(sdq_hs_10 = recode(sdq_hs_10, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_11_i_have_one_good_friend_or_more_choose_one, into = c("sdq_pps_11"), extra = "drop") |> 
  #inverted scoring, see sdq documentation
  mutate(sdq_pps_11 = recode(sdq_pps_11, 
                        "Not" = as.numeric(2),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(0),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_12_i_fight_a_lot_i_can_make_other_people_do_what_i_want_choose_one, into = c("sdq_cds_12"), extra = "drop") |> 
  mutate(sdq_cds_12 = recode(sdq_cds_12, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_13_i_am_often_unhappy_down_hearted_or_tearful_choose_one, into = c("sdq_ess_13"), extra = "drop") |> 
  mutate(sdq_ess_13 = recode(sdq_ess_13, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_14_other_people_my_age_generally_like_me_choose_one, into = c("sdq_pps_14"), extra = "drop") |> 
  #inverted scoring, see sdq documentation
  mutate(sdq_pps_14 = recode(sdq_pps_14, 
                        "Not" = as.numeric(2),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(0),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_15_i_am_easily_distracted_i_find_it_difficult_to_concentrate_choose_one, into = c("sdq_hs_15"), extra = "drop") |> 
  mutate(sdq_hs_15 = recode(sdq_hs_15, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_16_i_am_nervous_in_new_situations_i_easily_lose_confidence_choose_one, into = c("sdq_ess_16"), extra = "drop") |>  
  mutate(sdq_ess_16 = recode(sdq_ess_16, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_17_i_am_kind_to_younger_children_choose_one, into = c("sdq_ps_17"), extra = "drop") |> 
  mutate(sdq_ps_17 = recode(sdq_ps_17, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_18_i_am_often_accused_of_lying_or_cheating_choose_one, into = c("sdq_cds_18"), extra = "drop") |>  
  mutate(sdq_cds_18 = recode(sdq_cds_18, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_19_other_children_or_young_people_pick_on_me_or_bully_me_choose_one, into = c("sdq_pps_19"), extra = "drop") |> 
  mutate(sdq_pps_19 = recode(sdq_pps_19, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_20_i_often_volunteer_to_help_others_parents_teachers_children_choose_one, into = c("sdq_ps_20"), extra = "drop") |> 
  mutate(sdq_ps_20 = recode(sdq_ps_20, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_21_i_think_before_i_do_things_choose_one, into = c("sdq_hs_21"), extra = "drop") |>
  #inverted scoring, see sdq documentation
  mutate(sdq_hs_21 = recode(sdq_hs_21, 
                        "Not" = as.numeric(2),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(0),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_22_i_take_things_that_are_not_mine_from_home_school_or_elsewhere_choose_one, into = c("sdq_cds_22"), extra = "drop") |> 
  #inverted scoring, see sdq documentation
  mutate(sdq_cds_22 = recode(sdq_cds_22, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_23_i_get_on_better_with_adults_than_with_people_my_own_age_choose_one, into = c("sdq_pps_23"), extra = "drop") |> 
  mutate(sdq_pps_23 = recode(sdq_pps_23, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |>
  
  separate(sdq_24_i_have_many_fears_i_am_easily_scared_choose_one, into = c("sdq_ess_24"), extra = "drop") |> 
  mutate(sdq_ess_24 = recode(sdq_ess_24, 
                        "Not" = as.numeric(0),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(2),
                        "Prefer" = NA_real_
                        )) |> 
  
  separate(sdq_25_i_finish_the_work_im_doing_my_attention_is_good_choose_one, into = c("sdq_25"), extra = "drop") |> 
  #inverted scoring, see sdq documentation
  mutate(sdq_25 = recode(sdq_25, 
                        "Not" = as.numeric(2),
                        "Somewhat" = as.numeric(1), 
                        "Certainly" = as.numeric(0),
                        "Prefer" = NA_real_
                        )) 

print(timby_redcap_survey_responses)
#view(timby_redcap_survey_responses)

```

```{r importing redcap demographics}
#importing redcap demographics

timby_redcap_demographics = read_xlsx("./timby_analysis_data/timby_analysis_data_redcap_demographics.xlsx") |> 
  
  clean_names() |> 
  
  rename(juvenileid = six_digit_djj_id)

print(timby_redcap_demographics)
#view(timby_redcap_demographics)

```

```{r importing ehr juvenile general information}
#importing ehr juvenile general information

timby_ehr_juvenile_general_information = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 1) |> 
  
  clean_names() |> 
  
  mutate(service_provider = to_snake_case(as.character(service_provider))) |>  
  
  mutate(placement = to_snake_case(as.character(placement))) |> 
  
  separate(placement, into = c("location", "facility_type")) |> 
  
  select(-pde_completed_date_time)
  

print(timby_ehr_juvenile_general_information)
#view(timby_ehr_juvenile_general_information)

```

```{r importing ehr dsm dx}
#importing ehr dsm dx

timby_ehr_dsm_dx = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 2) |> 
  
  clean_names() |> 
  
  mutate(dsm_dx = to_snake_case(as.character(dsm_dx))) 
  
print(timby_ehr_dsm_dx)
#view(timby_ehr_dsm_dx)
```

```{r importing ehr mse}
#importing ehr mse

timby_ehr_mse = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 3) |>
  
  clean_names() |> 
  
  rename(appearance = mse_behavior_appearance, 
         age_representation = mse_behavior_actual_and_apparent_age,
         grooming = mse_behavior_grooming,
         hygiene = mse_behavior_hygiene, 
         demeanor = mse_behavior_demeanor,
         behavorial_observations = mse_behavior_behavioral_observations,
         attention = mse_sensorium_and_cognition_attention,
         concentration = mse_sensorium_and_cognition_concentration,
         orientation = mse_sensorium_and_cognition_orientation,
         memory = mse_sensorium_and_cognition_memory,
         vocabulary = mse_sensorium_and_cognition_vocabulary,
         comprehension = mse_sensorium_and_cognition_comprehension,
         knowledge = mse_sensorium_and_cognition_knowledge, 
         capacity_for_abstract_thinking = mse_sensorium_and_cognition_capacity_for_abstract_thinking,
         emotional_state = mse_emotional_state_affect, 
         emotional_range = mse_emotional_state_range_or_variability, 
         appropriateness_to_content_and_situation = mse_emotional_state_appropriateness_to_content_and_situation, 
         mood = mse_emotional_state_mood,
         hallucinations = mse_perception_hallucinations, 
         illusions = mse_perception_illusions, 
         reality_testing = mse_perception_reality_testing, 
         disturbance_of_consciousness = mse_perception_disturbance_of_consciousness,
         qmhp_comments = mse_perception_comments,
         speech = mse_thinking_speech,
         thought_process = mse_thinking_thought_process, 
         delusions = mse_thinking_thought_contents_delusions,
         preoccupations_intrusive_thoughts_and_overvalued_ideas = mse_thinking_thought_contents_preoccupations_intrusive_thoughts_and_overvalued_ideas,
         obsessions = mse_thinking_thought_contents_obsessions, 
         phobias = mse_thinking_thought_contents_phobias,  
         suicide = mse_thinking_thoughts_of_harm_to_self_or_others_suicide,
         self_harm = mse_thinking_thoughts_of_harm_to_self_or_others_self_harm,
         harm_to_others = mse_thinking_thoughts_of_harm_to_self_or_others_harm_to_others, 
         insights = mse_thinking_insight_and_judegment_insight, 
         judgements = mse_thinking_insight_and_judegment_judgement
         ) |> 
  
  separate(appearance, into = c("age", "year", "old", "race", "sex")) |> 
  
  select(-year, -old) |> 
  
  mutate(race = to_snake_case(as.character(race)),
         sex = to_snake_case(as.character(sex)),
         age_representation = to_snake_case(as.character(age_representation)),
         grooming = to_snake_case(as.character(grooming)), 
         hygiene = to_snake_case(as.character(hygiene)), 
         demeanor = to_snake_case(as.character(demeanor)), 
         behavorial_observations = to_snake_case(as.character(behavorial_observations)), 
         attention = to_snake_case(as.character(attention)), 
         concentration = to_snake_case(as.character(concentration)),
         orientation = to_snake_case(as.character(orientation)),
         memory = to_snake_case(as.character(memory)), 
         vocabulary = to_snake_case(as.character(vocabulary)), 
         comprehension = to_snake_case(as.character(comprehension)),
         knowledge = to_snake_case(as.character(knowledge)),
         capacity_for_abstract_thinking = to_snake_case(as.character(capacity_for_abstract_thinking)),
         emotional_state = to_snake_case(as.character(emotional_state)), 
         emotional_range = to_snake_case(as.character(emotional_range)),
         appropriateness_to_content_and_situation = to_snake_case(as.character(appropriateness_to_content_and_situation)), 
         mood = to_snake_case(as.character(mood)), 
         hallucinations = to_snake_case(as.character(hallucinations)),
         illusions = to_snake_case(as.character(illusions)), 
         reality_testing = to_snake_case(as.character(reality_testing)), 
         disturbance_of_consciousness = to_snake_case(as.character(disturbance_of_consciousness)), 
         qmhp_comments = to_snake_case(as.character(qmhp_comments)), 
         speech = to_snake_case(as.character(speech)), 
         thought_process = to_snake_case(as.character(thought_process)), 
         delusions = to_snake_case(as.character(delusions)), 
         preoccupations_intrusive_thoughts_and_overvalued_ideas = to_snake_case(as.character(preoccupations_intrusive_thoughts_and_overvalued_ideas)), 
         obsessions = to_snake_case(as.character(obsessions)), 
         phobias = to_snake_case(as.character(phobias)),
         suicide = to_snake_case(as.character(suicide)), 
         self_harm = to_snake_case(as.character(self_harm)), 
         harm_to_others = to_snake_case(as.character(harm_to_others)),
         insights = to_snake_case(as.character(insights)), 
         judgements = to_snake_case(as.character(judgements))
         ) |>
  
  separate(demeanor, into = c("demeanor_first_observation", "demeanor_second_observation")) |> 
  
  separate(behavorial_observations, into = c("behavioral_observations_first_observation", "behavioral_observations_second_observation", "behavioral_observations_third_observation")) |> 
  
  separate(emotional_state, into = c("emotional_state_first_observation", "emotional_state_second_observation")) |> 
  
  separate(mood, into = c("mood_first_observation", "mood_second_observation")) |> 
  
  separate(illusions, into = c("illusions_first_observation", "illusions_second_observation")) |> 
  
  separate(thought_process, into = c("thought_process_first_observation", "thought_process_second_observation")) |> 
  
  mutate(delusions = recode(delusions, "i_no_delusions" = "no"),
         preoccupations_intrusive_thoughts_and_overvalued_ideas = recode(preoccupations_intrusive_thoughts_and_overvalued_ideas, "ii_no_preoccupations_intrusive_thoughts_and_overvalued_ideas" = "no", "ii_yes_preoccupations_intrusive_thoughts_and_overvalued_ideas_may_have_some_that_he_s_unwilling_to_talk_about" = "yes"), 
         obsessions = recode(obsessions, "iii_no_obsessions" = "no"),
         phobias = recode(phobias, "iv_no_phobias" = "no"), 
         suicide = recode(suicide, "no_suicide" = "no"), 
         self_harm = recode(self_harm, "no_self_harm_non_suicidal" = "no",
                            "yes_self_harm_non_suicidal" = "yes"),
         harm_to_others = recode(harm_to_others, "no_harm_to_others" = "no")
         )

print(timby_ehr_mse)
#view(timby_ehr_mse)

```

```{r importing ehr medication}
#importing medication

timby_ehr_medication = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 4) |>
  
  clean_names() |> 
  
  mutate(psychotropic_medication = to_snake_case(as.character(psychotropic_medication)),
         target_symptom = to_snake_case(as.character(target_symptom)),
         dose_and_comments = to_snake_case(as.character(dose_and_comments)) 
         ) |> 
  
  mutate(psychotropic_medication = recode(psychotropic_medication, 
                                          "guanfacine_er_intuniv" = "guanfacineer_intuniv",
                                          "methylphenadate_hcl_concerta" = "methylphenadatehcl_concerta",
                                          "amphetamine_salts_adderallxr" = "amphetaminesalts_adderallxr")) |> 
  
  separate(psychotropic_medication, into = c("psychotropic_medication_generic", "psychotropic_medication_brand")) |> 
  
  mutate(psychotropic_medication_generic = recode(psychotropic_medication_generic, 
                                          "guanfacineer" = "guanfacine_er",
                                          "methylphenadatehcl" = "methylphenadate_hcl",
                                          "amphetaminesalts" = "amphetamine_salts")) |> 
  
  mutate(psychotropic_medication_brand = recode(psychotropic_medication_brand, 
                                          "adderallxr" = "adderall_xr"))
  

print(timby_ehr_medication)
#view(timby_ehr_medication)

```

```{r importing ehr substance abuse}
#importing ehr substance abuse

timby_ehr_substance_abuse = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 5) |> 
  
  clean_names() |> 
  
  mutate(substance_abuse_use_history = to_snake_case(as.character(substance_abuse_use_history))
         ) 

print(timby_ehr_substance_abuse)
#view(timby_ehr_substance_abuse)

```

```{r importing ehr non-psych medical hx}
#importing ehr non-psych medical hx

timby_ehr_non_psych_medical_hx = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 6) |>
  
  clean_names() |> 
  
  mutate(non_psychiatric_medical_history = to_snake_case(as.character(non_psychiatric_medical_history))
         )

print(timby_ehr_non_psych_medical_hx)
#view(timby_ehr_non_psych_medical_hx)

```

```{r importing ehr yoga}
#importing ehr yoga

timby_ehr_yoga = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 7) |>
  
  clean_names() 

print(timby_ehr_yoga)
#view(timby_ehr_yoga)

```

```{r importing ehr criminal charges}
#importing ehr criminal charges 

timby_ehr_criminal_charges = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 8) |>
  
  clean_names() |> 
  
  mutate(criminal_charges = to_snake_case(as.character(criminal_charges)))

print(timby_ehr_criminal_charges)
#view(timby_ehr_criminal_charges)

```

```{r importing ehr incidents}
#importing ehr incidents

timby_ehr_incidents = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 9) |>
  
  clean_names() |> 
  
  mutate(incident_site_name = to_snake_case(as.character(incident_site_name))) |> 
  
  mutate(incident_site_type = to_snake_case(as.character(incident_site_type))) |>
  
  mutate(incident_involvement_type = to_snake_case(as.character(incident_involvement_type))) |>
  
  separate(incident_site_name, into = c("incident_site", "site_type")) |> 
  
  select(-site_type) |> 
  
  rename(juvenileid = juvenile_id) |> 
  
  separate(incident_code, into = c("incident_code_one", "incident_code_two", "incident_code_three", "incident_code_four", "incident_code_five", "incident_code_six","incident_code_seven", "incident_code_eight", "incident_code_nine", "incident_code_ten")) 

print(timby_ehr_incidents)
#view(timby_ehr_incidents)

```

```{r importing ehr group training counseling}
#importing ehr group training counseling

timby_ehr_group_training_counseling = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 10) |>
  
  clean_names() |> 
  
  mutate(group_training_counseling = to_snake_case(as.character(group_training_counseling)))

print(timby_ehr_group_training_counseling)
#view(timby_ehr_group_training_counseling)

```

```{r importing ehr individual training counseling}
#importing ehr individual training counseling

timby_ehr_individual_training_counseling = read_xlsx("./timby_analysis_data/timby_analysis_data_ehr.xlsx", 11) |>
  
  clean_names() |> 
  
  mutate(individual_counseling = to_snake_case(as.character(individual_counseling)))

print(timby_ehr_individual_training_counseling)
#view(timby_ehr_individual_training_counseling)

```

```{r buliding full ehr}
#buliding full ehr df

timby_ehr_jgi_dsm = left_join(timby_ehr_juvenile_general_information, 
                           timby_ehr_dsm_dx
                           ) 

#print(timby_ehr_jgi_dsm)

timby_ehr_jgi_dsm_mse = left_join(timby_ehr_jgi_dsm,
                                  timby_ehr_mse
                                  )

#print(timby_ehr_jgi_dsm_mse)

timby_ehr_jgi_dsm_mse_medication = left_join(timby_ehr_jgi_dsm_mse,
                                             timby_ehr_medication
                                             )

#print(timby_ehr_jgi_dsm_mse_medication)

timby_ehr_jgi_dsm_mse_medication_substance = left_join(timby_ehr_jgi_dsm_mse_medication,
                                                       timby_ehr_substance_abuse
                                                       )

#print(timby_ehr_jgi_dsm_mse_medication_substance)

timby_ehr_jgi_dsm_mse_medication_substance_nonpsych = left_join(timby_ehr_jgi_dsm_mse_medication_substance, 
                                                                timby_ehr_non_psych_medical_hx) 

#print(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych)

timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga = left_join(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych, 
                                                                     timby_ehr_yoga)

#print(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga)

timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal = left_join(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga, 
                                                                     timby_ehr_criminal_charges)

#print(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal)

timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents = left_join(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal, 
                                                                     timby_ehr_incidents)

#print(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents)

#timby_ehr_individual_training_counseling

timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents_group = left_join(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents, 
                                                                     timby_ehr_group_training_counseling)

#print(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents_group)

timby_ehr_full = left_join(timby_ehr_jgi_dsm_mse_medication_substance_nonpsych_yoga_criminal_incidents_group, 
                                                    timby_ehr_individual_training_counseling)

print(timby_ehr_full)

```

```{r buliding full timby df}
#buliding full timby df

timby_study_id_demo = left_join(timby_redcap_study_id,
                                timby_redcap_demographics
                                ) 

#print(timby_study_id_demo)

timby_study_id_demo_survey = left_join(timby_study_id_demo, 
                                       timby_redcap_survey_responses
                                       )

#print(timby_study_id_demo_survey)

timby_full = left_join(timby_study_id_demo_survey,
                       timby_ehr_full
                       )

print(timby_full)
#view(timby_full)

```
